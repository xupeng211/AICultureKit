name: ðŸ“š Deploy Documentation

on:
  push:
    branches: [ main ]
    paths:
      - 'docs/**'
      - 'README.md'
      - '.github/workflows/docs.yml'
  pull_request:
    branches: [ main ]
    paths:
      - 'docs/**'
      - 'README.md'

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: ðŸ“¥ Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: ðŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: ðŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install mkdocs mkdocs-material mkdocs-mermaid2-plugin

    - name: ðŸ—ï¸ Build documentation
      run: |
        # åˆ›å»ºdocsç›®å½•ç»“æž„ï¼ˆå¦‚æžœä¸å­˜åœ¨ï¼‰
        mkdir -p docs
        
        # å¤åˆ¶READMEä½œä¸ºé¦–é¡µ
        cp README.md docs/index.md
        
        # åˆ›å»ºåŸºæœ¬çš„mkdocsé…ç½®
        cat > mkdocs.yml << EOF
        site_name: AICultureKit Documentation
        site_description: ä¼ä¸šçº§AIä¸»å¯¼å¼€å‘æ–‡åŒ–æ ‡å‡†åŒ–å·¥å…·åŒ…
        site_url: https://xupeng211.github.io/AICultureKit/
        repo_url: https://github.com/xupeng211/AICultureKit
        repo_name: xupeng211/AICultureKit
        
        theme:
          name: material
          palette:
            - scheme: default
              primary: blue
              accent: blue
              toggle:
                icon: material/brightness-7
                name: Switch to dark mode
            - scheme: slate
              primary: blue
              accent: blue
              toggle:
                icon: material/brightness-4
                name: Switch to light mode
          features:
            - navigation.tabs
            - navigation.sections
            - navigation.expand
            - navigation.top
            - search.highlight
            - content.code.copy
        
        nav:
          - é¦–é¡µ: index.md
          - å¿«é€Ÿå¼€å§‹: getting-started.md
          - APIå‚è€ƒ: api-reference.md
          - æœ€ä½³å®žè·µ: best-practices.md
          - è´¡çŒ®æŒ‡å—: contributing.md
        
        plugins:
          - search
          - mermaid2
        
        markdown_extensions:
          - admonition
          - codehilite
          - pymdownx.superfences:
              custom_fences:
                - name: mermaid
                  class: mermaid
                  format: !!python/name:mermaid2.fence_mermaid
        EOF
        
        # åˆ›å»ºå…¶ä»–æ–‡æ¡£é¡µé¢
        cp docs/API_REFERENCE.md docs/api-reference.md 2>/dev/null || echo "# APIå‚è€ƒ\n\næ­£åœ¨å®Œå–„ä¸­..." > docs/api-reference.md
        cp docs/BEST_PRACTICES_GUIDE.md docs/best-practices.md 2>/dev/null || echo "# æœ€ä½³å®žè·µ\n\næ­£åœ¨å®Œå–„ä¸­..." > docs/best-practices.md
        cp CONTRIBUTING.md docs/contributing.md 2>/dev/null || echo "# è´¡çŒ®æŒ‡å—\n\næ­£åœ¨å®Œå–„ä¸­..." > docs/contributing.md
        
        # åˆ›å»ºå¿«é€Ÿå¼€å§‹é¡µé¢
        cat > docs/getting-started.md << EOF
        # ðŸš€ å¿«é€Ÿå¼€å§‹
        
        ## å®‰è£…
        
        \`\`\`bash
        pip install aiculture-kit
        \`\`\`
        
        ## åˆ›å»ºç¬¬ä¸€ä¸ªé¡¹ç›®
        
        \`\`\`bash
        aiculture create my-project
        cd my-project
        \`\`\`
        
        ## è¿è¡Œè´¨é‡æ£€æŸ¥
        
        \`\`\`bash
        aiculture check
        \`\`\`
        
        æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ [APIå‚è€ƒ](api-reference.md)ã€‚
        EOF
        
        # æž„å»ºæ–‡æ¡£
        mkdocs build

    - name: ðŸ“¤ Upload artifact
      uses: actions/upload-pages-artifact@v2
      with:
        path: ./site

  deploy:
    if: github.ref == 'refs/heads/main'
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: ðŸš€ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
