name: Robust CI/CD Pipeline
# åŸºäºAIå¼€å‘æ–‡åŒ–çš„å¼ºåŒ–CI/CDæµæ°´çº¿ï¼Œæœ€å¤§åŒ–æ„å»ºæˆåŠŸç‡

on:
  push:
    branches: [ main, develop ]
    tags: [ 'v*' ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      force_rebuild:
        description: 'å¼ºåˆ¶é‡å»ºï¼ˆè·³è¿‡ç¼“å­˜ï¼‰'
        required: false
        default: 'false'
        type: boolean
      environment:
        description: 'éƒ¨ç½²ç¯å¢ƒ'
        required: true
        default: 'staging'
        type: choice
        options:
        - staging
        - production

env:
  REGISTRY: docker.io
  IMAGE_NAME: aiculture-kit
  PYTHON_VERSION: "3.10"
  NODE_VERSION: "18"

jobs:
  # ===== ç¬¬ä¸€é˜¶æ®µï¼šé¢„æ£€æµ‹ =====
  pre-validation:
    name: ğŸ” æ„å»ºå‰é¢„æ£€æµ‹
    runs-on: ubuntu-latest
    timeout-minutes: 15
    outputs:
      risk-score: ${{ steps.health-check.outputs.score }}
      can-proceed: ${{ steps.health-check.outputs.can-proceed }}
      
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # å®Œæ•´å†å²ï¼Œç”¨äºå˜æ›´åˆ†æ
    
    - name: ğŸ”§ è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        cache: 'pip'
    
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements-dev.txt
        pip install requests pyyaml docker
    
    - name: ğŸ¤– AIå¼€å‘æ–‡åŒ–æ£€æŸ¥
      id: ai-culture-check
      run: |
        echo "ğŸ¤– æ‰§è¡ŒAIå¼€å‘æ–‡åŒ–åŸåˆ™æ£€æŸ¥..."
        python -m aiculture.cli validate --path .
        echo "culture-check=$?" >> $GITHUB_OUTPUT
    
    - name: ğŸ” CI/CDå¥åº·æ£€æŸ¥
      id: health-check
      run: |
        echo "ğŸ” æ‰§è¡Œå…¨é¢å¥åº·æ£€æŸ¥..."
        python -c "
        from aiculture.cicd_guardian import run_cicd_health_check
        import json
        
        report = run_cicd_health_check('.')
        print(f'å¥åº·æ£€æŸ¥å®Œæˆï¼Œé£é™©è¯„åˆ†: {report[\"score\"]}/100')
        print(f'é£é™©ç»Ÿè®¡: {report[\"risk_summary\"]}')
        
        # è¾“å‡ºç»“æœåˆ°GitHub Actions
        with open('health-report.json', 'w') as f:
            json.dump(report, f, indent=2)
        
        # è®¾ç½®è¾“å‡ºå˜é‡
        print(f'score={report[\"score\"]}')
        print(f'can-proceed={\"true\" if report[\"score\"] >= 70 else \"false\"}')
        " | tee -a $GITHUB_OUTPUT
    
    - name: ğŸ“Š ä¸Šä¼ å¥åº·æŠ¥å‘Š
      uses: actions/upload-artifact@v3
      with:
        name: health-report
        path: health-report.json
    
    - name: ğŸš¨ é£é™©è¯„ä¼°
      run: |
        SCORE=${{ steps.health-check.outputs.score }}
        if [ "$SCORE" -lt 50 ]; then
          echo "ğŸ”¥ é£é™©è¯„åˆ†è¿‡ä½ ($SCORE/100)ï¼Œç¦æ­¢ç»§ç»­æ„å»º"
          exit 1
        elif [ "$SCORE" -lt 70 ]; then
          echo "âš ï¸ å­˜åœ¨ä¸­ç­‰é£é™© ($SCORE/100)ï¼Œå°†å°è¯•è‡ªåŠ¨ä¿®å¤"
        else
          echo "âœ… é£é™©è¯„åˆ†è‰¯å¥½ ($SCORE/100)ï¼Œå¯ä»¥å®‰å…¨æ„å»º"
        fi

  # ===== ç¬¬äºŒé˜¶æ®µï¼šè‡ªåŠ¨ä¿®å¤ =====
  auto-fix:
    name: ğŸ”§ è‡ªåŠ¨é—®é¢˜ä¿®å¤
    runs-on: ubuntu-latest
    needs: pre-validation
    if: needs.pre-validation.outputs.risk-score < 70 && needs.pre-validation.outputs.risk-score >= 50
    timeout-minutes: 10
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: ğŸ”§ è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
    
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        pip install -r requirements-dev.txt
        pip install requests pyyaml docker
    
    - name: ğŸ¤– æ‰§è¡Œè‡ªåŠ¨ä¿®å¤
      run: |
        echo "ğŸ”§ å¼€å§‹è‡ªåŠ¨ä¿®å¤é—®é¢˜..."
        python -c "
        from aiculture.cicd_guardian import auto_fix_cicd_issues
        import json
        
        result = auto_fix_cicd_issues('.')
        print(f'ä¿®å¤ç»“æœ: æˆåŠŸ {len(result[\"fixed\"])}, å¤±è´¥ {len(result[\"failed\"])}')
        print(f'æˆåŠŸç‡: {result[\"success_rate\"]:.1%}')
        
        if result['fixed']:
            print('å·²ä¿®å¤çš„é—®é¢˜:')
            for issue in result['fixed']:
                print(f'  âœ… {issue}')
        
        if result['failed']:
            print('æœªèƒ½ä¿®å¤çš„é—®é¢˜:')
            for issue in result['failed']:
                print(f'  âŒ {issue}')
        "
    
    - name: ğŸ“ æäº¤ä¿®å¤
      run: |
        git config --global user.name 'AI Culture Bot'
        git config --global user.email 'ai-culture@noreply.github.com'
        
        if git diff --quiet; then
          echo "æ²¡æœ‰éœ€è¦æäº¤çš„ä¿®å¤"
        else
          git add .
          git commit -m "ğŸ¤– AIè‡ªåŠ¨ä¿®å¤CI/CDé—®é¢˜
          
          - ä¿®å¤äº†æ„å»ºé£é™©é—®é¢˜
          - ä¼˜åŒ–äº†é…ç½®æ–‡ä»¶
          - æé«˜äº†æ„å»ºæˆåŠŸç‡
          
          Co-authored-by: AI Culture System <ai-culture@noreply.github.com>"
          git push
          echo "âœ… ä¿®å¤å·²æäº¤"
        fi

  # ===== ç¬¬ä¸‰é˜¶æ®µï¼šæµ‹è¯• =====
  test:
    name: ğŸ§ª ä»£ç æµ‹è¯•
    runs-on: ubuntu-latest
    needs: pre-validation
    if: always() && needs.pre-validation.outputs.can-proceed == 'true'
    timeout-minutes: 20
    strategy:
      matrix:
        python-version: ["3.8", "3.9", "3.10", "3.11"]
      fail-fast: false  # ä¸€ä¸ªç‰ˆæœ¬å¤±è´¥ä¸å½±å“å…¶ä»–ç‰ˆæœ¬
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
    
    - name: ğŸ”§ è®¾ç½®Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
        cache: 'pip'
    
    - name: ğŸ“¦ å®‰è£…ä¾èµ–ï¼ˆå¸¦é‡è¯•ï¼‰
      uses: nick-fields/retry@v2
      with:
        timeout_minutes: 10
        max_attempts: 3
        command: |
          python -m pip install --upgrade pip
          pip install -r requirements-dev.txt
    
    - name: ğŸ” ä»£ç è´¨é‡æ£€æŸ¥
      run: |
        echo "ğŸ” æ‰§è¡Œä»£ç è´¨é‡æ£€æŸ¥..."
        
        # ä»£ç æ ¼å¼æ£€æŸ¥
        black --check . || (echo "âŒ ä»£ç æ ¼å¼ä¸è§„èŒƒ" && exit 1)
        
        # å¯¼å…¥æ’åºæ£€æŸ¥
        isort --check-only . || (echo "âŒ å¯¼å…¥æ’åºä¸è§„èŒƒ" && exit 1)
        
        # è¯­æ³•æ£€æŸ¥
        flake8 . || (echo "âŒ ä»£ç è¯­æ³•é—®é¢˜" && exit 1)
        
        # ç±»å‹æ£€æŸ¥
        mypy . || echo "âš ï¸ ç±»å‹æ£€æŸ¥æœ‰è­¦å‘Š"
        
        echo "âœ… ä»£ç è´¨é‡æ£€æŸ¥é€šè¿‡"
    
    - name: ğŸ”’ å®‰å…¨æ£€æŸ¥
      run: |
        echo "ğŸ”’ æ‰§è¡Œå®‰å…¨æ£€æŸ¥..."
        
        # ä¾èµ–å®‰å…¨æ£€æŸ¥
        safety check -r requirements.txt || echo "âš ï¸ å‘ç°ä¾èµ–å®‰å…¨é—®é¢˜"
        
        # ä»£ç å®‰å…¨æ£€æŸ¥
        bandit -r . -f json -o bandit-report.json || echo "âš ï¸ å‘ç°ä»£ç å®‰å…¨é—®é¢˜"
        
        echo "âœ… å®‰å…¨æ£€æŸ¥å®Œæˆ"
    
    - name: ğŸ§ª è¿è¡Œæµ‹è¯•
      run: |
        echo "ğŸ§ª æ‰§è¡Œå•å…ƒæµ‹è¯•..."
        pytest --cov=aiculture --cov-report=xml --cov-report=term-missing -v
    
    - name: ğŸ“Š ä¸Šä¼ è¦†ç›–ç‡æŠ¥å‘Š
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage.xml
        fail_ci_if_error: false

  # ===== ç¬¬å››é˜¶æ®µï¼šæ„å»ºé•œåƒ =====
  build-image:
    name: ğŸ³ æ„å»ºDockeré•œåƒ
    runs-on: ubuntu-latest
    needs: [pre-validation, test]
    if: always() && needs.pre-validation.outputs.can-proceed == 'true' && needs.test.result == 'success'
    timeout-minutes: 45
    strategy:
      matrix:
        platform: [linux/amd64, linux/arm64]
      fail-fast: false
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
    
    - name: ğŸ’¾ æ£€æŸ¥ç£ç›˜ç©ºé—´
      run: |
        echo "ğŸ’¾ æ£€æŸ¥å¯ç”¨ç£ç›˜ç©ºé—´..."
        df -h
        AVAILABLE=$(df / | tail -1 | awk '{print $4}' | sed 's/G//')
        if [ "$AVAILABLE" -lt 10 ]; then
          echo "âŒ ç£ç›˜ç©ºé—´ä¸è¶³: ${AVAILABLE}GB"
          exit 1
        fi
        echo "âœ… ç£ç›˜ç©ºé—´å……è¶³: ${AVAILABLE}GB"
    
    - name: ğŸ”§ è®¾ç½®Docker Buildx
      uses: docker/setup-buildx-action@v3
      with:
        driver-opts: |
          network=host
          
    - name: ğŸ³ ç™»å½•Docker Hubï¼ˆå¸¦é‡è¯•ï¼‰
      uses: nick-fields/retry@v2
      with:
        timeout_minutes: 5
        max_attempts: 3
        command: |
          echo ${{ secrets.DOCKERHUB_TOKEN }} | docker login -u ${{ secrets.DOCKERHUB_USERNAME }} --password-stdin
    
    - name: ğŸ“‹ æå–é•œåƒå…ƒæ•°æ®
      id: meta
      uses: docker/metadata-action@v5
      with:
        images: ${{ env.REGISTRY }}/${{ secrets.DOCKERHUB_USERNAME }}/${{ env.IMAGE_NAME }}
        tags: |
          type=ref,event=branch
          type=ref,event=pr
          type=semver,pattern={{version}}
          type=semver,pattern={{major}}.{{minor}}
          type=raw,value=latest,enable={{is_default_branch}}
          type=sha,prefix={{branch}}-
    
    - name: ğŸ§¹ æ¸…ç†Dockerç¯å¢ƒ
      run: |
        echo "ğŸ§¹ æ¸…ç†Dockerç¯å¢ƒ..."
        docker system prune -f --volumes
        docker builder prune -f
    
    - name: ğŸ“¥ é¢„æ‹‰å–åŸºç¡€é•œåƒ
      run: |
        echo "ğŸ“¥ é¢„æ‹‰å–åŸºç¡€é•œåƒä»¥æé«˜æ„å»ºé€Ÿåº¦..."
        docker pull python:3.10-slim || echo "é¢„æ‹‰å–å¤±è´¥ï¼Œæ„å»ºæ—¶é‡æ–°æ‹‰å–"
    
    - name: ğŸ”¨ æ„å»ºå¹¶æ¨é€é•œåƒï¼ˆå¸¦é‡è¯•ï¼‰
      uses: nick-fields/retry@v2
      with:
        timeout_minutes: 30
        max_attempts: 3
        retry_on: error
        command: |
          docker buildx build \
            --platform ${{ matrix.platform }} \
            --tag ${{ steps.meta.outputs.tags }} \
            --label ${{ steps.meta.outputs.labels }} \
            --cache-from type=gha,scope=${{ matrix.platform }} \
            --cache-to type=gha,mode=max,scope=${{ matrix.platform }} \
            --push \
            --progress=plain \
            .

  # ===== ç¬¬äº”é˜¶æ®µï¼šé•œåƒéªŒè¯ =====
  verify-image:
    name: âœ… é•œåƒéªŒè¯
    runs-on: ubuntu-latest
    needs: build-image
    if: always() && needs.build-image.result == 'success'
    timeout-minutes: 15
    
    steps:
    - name: ğŸ³ ç™»å½•Docker Hub
      run: echo ${{ secrets.DOCKERHUB_TOKEN }} | docker login -u ${{ secrets.DOCKERHUB_USERNAME }} --password-stdin
    
    - name: ğŸ“¥ æ‹‰å–é•œåƒ
      run: |
        IMAGE_TAG="${{ env.REGISTRY }}/${{ secrets.DOCKERHUB_USERNAME }}/${{ env.IMAGE_NAME }}:latest"
        echo "ğŸ“¥ æ‹‰å–é•œåƒ: $IMAGE_TAG"
        docker pull $IMAGE_TAG
    
    - name: ğŸ” åŸºç¡€åŠŸèƒ½æµ‹è¯•
      run: |
        IMAGE_TAG="${{ env.REGISTRY }}/${{ secrets.DOCKERHUB_USERNAME }}/${{ env.IMAGE_NAME }}:latest"
        echo "ğŸ” æµ‹è¯•é•œåƒåŸºç¡€åŠŸèƒ½..."
        
        # æµ‹è¯•é•œåƒå¯åŠ¨
        docker run --rm $IMAGE_TAG aiculture --version
        
        # æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
        docker run --rm $IMAGE_TAG aiculture list-principles
        
        echo "âœ… é•œåƒåŠŸèƒ½æµ‹è¯•é€šè¿‡"
    
    - name: ğŸ“ é•œåƒå¤§å°æ£€æŸ¥
      run: |
        IMAGE_TAG="${{ env.REGISTRY }}/${{ secrets.DOCKERHUB_USERNAME }}/${{ env.IMAGE_NAME }}:latest"
        SIZE=$(docker image inspect $IMAGE_TAG --format='{{.Size}}')
        SIZE_MB=$((SIZE/1000000))
        echo "ğŸ“ é•œåƒå¤§å°: ${SIZE_MB}MB"
        
        if [ $SIZE_MB -gt 800 ]; then
          echo "âš ï¸ é•œåƒè¿‡å¤§: ${SIZE_MB}MB (å»ºè®®<800MB)"
          # ä¸è¦å¤±è´¥ï¼Œåªæ˜¯è­¦å‘Š
        else
          echo "âœ… é•œåƒå¤§å°åˆç†: ${SIZE_MB}MB"
        fi
    
    - name: ğŸ”’ å®‰å…¨æ‰«æ
      uses: aquasecurity/trivy-action@master
      with:
        image-ref: ${{ env.REGISTRY }}/${{ secrets.DOCKERHUB_USERNAME }}/${{ env.IMAGE_NAME }}:latest
        format: 'sarif'
        output: 'trivy-results.sarif'
        exit-code: '0'  # ä¸å› å®‰å…¨é—®é¢˜å¤±è´¥ï¼Œä½†ä¼šè®°å½•
        severity: 'CRITICAL,HIGH'
    
    - name: ğŸ“Š ä¸Šä¼ å®‰å…¨æ‰«æç»“æœ
      if: always()
      uses: github/codeql-action/upload-sarif@v2
      with:
        sarif_file: 'trivy-results.sarif'

  # ===== ç¬¬å…­é˜¶æ®µï¼šéƒ¨ç½²å†³ç­– =====
  deployment-gate:
    name: ğŸšª éƒ¨ç½²å†³ç­–é—¨
    runs-on: ubuntu-latest
    needs: [verify-image, test]
    if: always()
    timeout-minutes: 5
    outputs:
      should-deploy: ${{ steps.decision.outputs.should-deploy }}
    
    steps:
    - name: ğŸ“Š æ±‡æ€»æ„å»ºç»“æœ
      id: decision
      run: |
        echo "ğŸ“Š æ±‡æ€»æ‰€æœ‰é˜¶æ®µç»“æœ..."
        
        TEST_RESULT="${{ needs.test.result }}"
        BUILD_RESULT="${{ needs.build-image.result }}"
        VERIFY_RESULT="${{ needs.verify-image.result }}"
        
        echo "æµ‹è¯•ç»“æœ: $TEST_RESULT"
        echo "æ„å»ºç»“æœ: $BUILD_RESULT"
        echo "éªŒè¯ç»“æœ: $VERIFY_RESULT"
        
        if [ "$TEST_RESULT" == "success" ] && \
           [ "$BUILD_RESULT" == "success" ] && \
           [ "$VERIFY_RESULT" == "success" ]; then
          echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥éƒ¨ç½²"
          echo "should-deploy=true" >> $GITHUB_OUTPUT
        else
          echo "âŒ å­˜åœ¨å¤±è´¥çš„æ£€æŸ¥ï¼Œä¸èƒ½éƒ¨ç½²"
          echo "should-deploy=false" >> $GITHUB_OUTPUT
        fi

  # ===== ç¬¬ä¸ƒé˜¶æ®µï¼šæ•…éšœæ¢å¤ =====
  failure-recovery:
    name: ğŸš¨ æ•…éšœæ¢å¤
    runs-on: ubuntu-latest
    needs: [pre-validation, test, build-image, verify-image]
    if: failure()
    timeout-minutes: 10
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
    
    - name: ğŸ” æ•…éšœåˆ†æ
      run: |
        echo "ğŸ” åˆ†ææ„å»ºå¤±è´¥åŸå› ..."
        
        echo "å„é˜¶æ®µçŠ¶æ€:"
        echo "é¢„æ£€æµ‹: ${{ needs.pre-validation.result }}"
        echo "æµ‹è¯•: ${{ needs.test.result }}"
        echo "æ„å»º: ${{ needs.build-image.result }}"
        echo "éªŒè¯: ${{ needs.verify-image.result }}"
        
        # ç”Ÿæˆæ•…éšœæŠ¥å‘Š
        cat << EOF > failure-report.md
        # ğŸš¨ CI/CD æ„å»ºå¤±è´¥æŠ¥å‘Š
        
        **æ—¶é—´**: $(date)
        **åˆ†æ”¯**: ${{ github.ref_name }}
        **æäº¤**: ${{ github.sha }}
        **è§¦å‘è€…**: ${{ github.actor }}
        
        ## å¤±è´¥é˜¶æ®µ
        - é¢„æ£€æµ‹: ${{ needs.pre-validation.result }}
        - æµ‹è¯•: ${{ needs.test.result }}
        - æ„å»º: ${{ needs.build-image.result }}
        - éªŒè¯: ${{ needs.verify-image.result }}
        
        ## å»ºè®®æªæ–½
        1. æ£€æŸ¥ä»£ç è´¨é‡å’Œä¾èµ–
        2. è¿è¡Œæœ¬åœ°æµ‹è¯•ç¡®ä¿é€šè¿‡
        3. æ£€æŸ¥Dockeré…ç½®
        4. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
        
        EOF
        
        cat failure-report.md
    
    - name: ğŸ”„ å°è¯•è‡ªåŠ¨å›æ»š
      if: github.ref == 'refs/heads/main'
      run: |
        echo "ğŸ”„ å°è¯•è‡ªåŠ¨å›æ»šåˆ°æœ€åä¸€ä¸ªç¨³å®šç‰ˆæœ¬..."
        
        # è¿™é‡Œå¯ä»¥æ·»åŠ è‡ªåŠ¨å›æ»šé€»è¾‘
        # ä¾‹å¦‚ï¼šå›æ»šåˆ°ä¸Šä¸€ä¸ªæˆåŠŸçš„é•œåƒæ ‡ç­¾
        echo "å›æ»šé€»è¾‘éœ€è¦æ ¹æ®å…·ä½“éƒ¨ç½²ç¯å¢ƒå®ç°"
    
    - name: ğŸ“¢ å‘é€é€šçŸ¥
      run: |
        echo "ğŸ“¢ å‘é€å¤±è´¥é€šçŸ¥..."
        
        MESSAGE="ğŸš¨ AICultureKit CI/CD æ„å»ºå¤±è´¥
        
        ğŸ“‹ è¯¦æƒ…:
        - åˆ†æ”¯: ${{ github.ref_name }}
        - æäº¤: ${{ github.sha }}
        - ä½œè€…: ${{ github.actor }}
        - æ—¶é—´: $(date)
        - æ—¥å¿—: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
        
        ğŸ¤– è¯·æŒ‰AIå¼€å‘æ–‡åŒ–åŸåˆ™è¿›è¡Œä¿®å¤"
        
        echo "$MESSAGE"
        
        # å¦‚æœé…ç½®äº†Webhookï¼Œå¯ä»¥å‘é€é€šçŸ¥
        if [ -n "${{ secrets.TEAM_WEBHOOK }}" ]; then
          curl -X POST "${{ secrets.TEAM_WEBHOOK }}" \
            -H 'Content-type: application/json' \
            --data "{\"text\":\"$MESSAGE\"}" || echo "é€šçŸ¥å‘é€å¤±è´¥"
        fi

  # ===== ç¬¬å…«é˜¶æ®µï¼šæˆåŠŸåå¤„ç† =====
  post-success:
    name: ğŸ‰ æˆåŠŸåå¤„ç†
    runs-on: ubuntu-latest
    needs: [deployment-gate]
    if: needs.deployment-gate.outputs.should-deploy == 'true'
    timeout-minutes: 5
    
    steps:
    - name: ğŸ“Š è®°å½•æˆåŠŸæŒ‡æ ‡
      run: |
        echo "ğŸ‰ æ„å»ºæˆåŠŸå®Œæˆï¼"
        echo "âœ… æ‰€æœ‰è´¨é‡æ£€æŸ¥é€šè¿‡"
        echo "âœ… é•œåƒæ„å»ºæˆåŠŸ"
        echo "âœ… å®‰å…¨æ‰«æé€šè¿‡"
        echo "ğŸš€ å‡†å¤‡éƒ¨ç½²"
    
    - name: ğŸ“ˆ æ›´æ–°æŒ‡æ ‡
      run: |
        echo "ğŸ“ˆ æ›´æ–°æ„å»ºæˆåŠŸç‡æŒ‡æ ‡..."
        # è¿™é‡Œå¯ä»¥é›†æˆç›‘æ§ç³»ç»Ÿ
        echo "æ„å»ºæˆåŠŸæ—¶é—´: $(date)"
        echo "Git SHA: ${{ github.sha }}"
    
    - name: ğŸŠ å‘é€æˆåŠŸé€šçŸ¥
      run: |
        echo "ğŸŠ å‘é€æˆåŠŸé€šçŸ¥..."
        
        MESSAGE="ğŸ‰ AICultureKit æ„å»ºæˆåŠŸï¼
        
        âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡
        ğŸ³ é•œåƒå·²å°±ç»ª
        ğŸš€ å¯ä»¥éƒ¨ç½²
        
        åˆ†æ”¯: ${{ github.ref_name }}
        æäº¤: ${{ github.sha }}
        "
        
        echo "$MESSAGE" 