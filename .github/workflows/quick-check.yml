name: Quick Check

on:
  push:
    branches-ignore:
      - main

permissions:
  contents: read

jobs:
  quick:
    name: Quick Lint & Test
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install tools
        run: |
          python -m pip install -U pip
          python -m pip install "ruff==0.5.7"

      # 软失败：格式检查（不阻断）
      - name: Format check (Ruff)
        continue-on-error: true
        run: |
          python -m ruff --version
          # --isolated：忽略任何 pyproject/ruff.toml，避免解析模板文件
          # --check：只检查格式，不写回
          python -m ruff format . --check --isolated

      # 软失败：静态检查（不阻断）
      - name: Lint check (Ruff)
        continue-on-error: true
        run: |
          python -m ruff check . --output-format=github --isolated

      # 真正的"快速测试"：只做语法编译，不 import 依赖，不运行单测
      - name: Quick syntax smoke (compile-only)
        run: |
          python - << 'PY'
          import compileall, sys
          ok = compileall.compile_dir("aiculture", force=True, quiet=1)
          # 返回码为 0 表示成功；compile_dir 返回 True/False，这里转化为 shell 约定
          sys.exit(0 if ok else 1)
          PY

