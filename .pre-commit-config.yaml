# AICultureKit 智能自动化 pre-commit 配置
# 自动修复代码质量问题，确保开发文化一致性

repos:
  # 🎨 Python 代码格式化 (自动修复)
  - repo: https://github.com/psf/black
    rev: 23.12.1
    hooks:
      - id: black
        language_version: python3
        args: [--line-length=88]
        stages: [commit, manual]

  # 📦 Python 导入排序 (自动修复)
  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args: [--profile=black, --line-length=88]
        stages: [commit, manual]

  # 🧹 自动移除未使用的导入
  - repo: https://github.com/PyCQA/autoflake
    rev: v2.2.1
    hooks:
      - id: autoflake
        args: [
          --in-place,
          --remove-all-unused-imports,
          --remove-unused-variables,
          --remove-duplicate-keys,
          --expand-star-imports
        ]
        stages: [commit, manual]

  # 🔍 Python 代码检查 (非阻塞，仅警告)
  - repo: https://github.com/pycqa/flake8
    rev: 7.0.0
    hooks:
      - id: flake8
        exclude: ^(aiculture-env/|\.venv/|venv/|tests/)
        stages: [manual]  # 只在手动运行时检查，不阻塞提交

  # 🔧 Python 类型检查 (非阻塞)
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        additional_dependencies: [types-PyYAML, types-requests, types-click]
        args: [--ignore-missing-imports, --no-error-summary]
        exclude: ^(aiculture-env/|\.venv/|venv/|tests/)
        stages: [manual]  # 只在手动运行时检查

  # 🧪 自动运行快速测试
  - repo: local
    hooks:
      - id: quick-tests
        name: 快速测试检查
        entry: python -m pytest tests/ -x --tb=no -q
        language: system
        stages: [commit]
        pass_filenames: false

  # Python 安全检查 (暂时禁用，配置问题)
  # - repo: https://github.com/PyCQA/bandit
  #   rev: 1.7.5
  #   hooks:
  #     - id: bandit
  #       args: [-r, aiculture, -s, B101,B601]
  #       exclude: ^(tests/|aiculture-env/|\.venv/|venv/)

  # 通用文件检查
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-json
      - id: check-toml
      - id: check-merge-conflict
      - id: check-added-large-files
        args: [--maxkb=1000]
      - id: detect-private-key

  # 密钥泄漏检测 (暂时禁用，版本兼容问题)
  # - repo: https://github.com/Yelp/detect-secrets
  #   rev: v1.4.0
  #   hooks:
  #     - id: detect-secrets
  #       args: [--baseline, .secrets.baseline]
  #       exclude: package.lock.json

# 本地钩子配置
default_language_version:
  python: python3

# 最小 pre-commit 版本
minimum_pre_commit_version: 3.0.0

# 性能优化的全局配置
default_stages: [commit]  # 只在commit时运行，不在push时运行
fail_fast: false  # 不要在第一个错误时停止
