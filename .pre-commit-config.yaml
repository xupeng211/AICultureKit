# AICultureKit æ™ºèƒ½è‡ªåŠ¨åŒ– pre-commit é…ç½®
# è‡ªåŠ¨ä¿®å¤ä»£ç è´¨é‡é—®é¢˜ï¼Œç¡®ä¿å¼€å‘æ–‡åŒ–ä¸€è‡´æ€§

repos:
  # ğŸ¨ Python ä»£ç æ ¼å¼åŒ– (è‡ªåŠ¨ä¿®å¤)
  - repo: https://github.com/psf/black
    rev: 23.12.1
    hooks:
      - id: black
        language_version: python3
        args: [--line-length=88]
        stages: [pre-commit, manual]

  # ğŸ“¦ Python å¯¼å…¥æ’åº (è‡ªåŠ¨ä¿®å¤)
  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args: [--profile=black, --line-length=88]
        stages: [pre-commit, manual]

  # ğŸ§¹ è‡ªåŠ¨ç§»é™¤æœªä½¿ç”¨çš„å¯¼å…¥
  - repo: https://github.com/PyCQA/autoflake
    rev: v2.2.1
    hooks:
      - id: autoflake
        args:
          [
            --in-place,
            --remove-all-unused-imports,
            --remove-unused-variables,
            --remove-duplicate-keys,
            --expand-star-imports,
          ]
        stages: [pre-commit, manual]

  # ğŸ” Python ä»£ç æ£€æŸ¥ (éé˜»å¡ï¼Œä»…è­¦å‘Š)
  - repo: https://github.com/pycqa/flake8
    rev: 7.0.0
    hooks:
      - id: flake8
        exclude: ^(aiculture-env/|\.venv/|venv/|tests/)
        stages: [manual] # åªåœ¨æ‰‹åŠ¨è¿è¡Œæ—¶æ£€æŸ¥ï¼Œä¸é˜»å¡æäº¤

  # ğŸ”§ Python ç±»å‹æ£€æŸ¥ (éé˜»å¡)
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        additional_dependencies: [types-PyYAML, types-requests, types-click]
        args: [--ignore-missing-imports, --no-error-summary]
        exclude: ^(aiculture-env/|\.venv/|venv/|tests/)
        stages: [manual] # åªåœ¨æ‰‹åŠ¨è¿è¡Œæ—¶æ£€æŸ¥

  # AICultureKitæœ¬åœ°é’©å­
  - repo: local
    hooks:
      # ğŸ§ª è‡ªåŠ¨è¿è¡Œå¿«é€Ÿæµ‹è¯• (æš‚æ—¶ç¦ç”¨ï¼Œä¸é˜»å¡æäº¤)
      # - id: quick-tests
      #   name: å¿«é€Ÿæµ‹è¯•æ£€æŸ¥
      #   entry: python -m pytest tests/ -x --tb=no -q
      #   language: system
      #   stages: [pre-commit]
      #   pass_filenames: false

      # ğŸ” AICultureKité—®é¢˜èšåˆå™¨é›†æˆ
      - id: aiculture-problem-aggregator
        name: "ğŸ” AICultureKité—®é¢˜èšåˆ"
        entry: python -m tools.problem_aggregator.aggregator
        language: system
        args:
          [
            --out,
            artifacts/pre-commit-problems.json,
            --md,
            artifacts/pre-commit-report.md,
          ]
        always_run: true
        pass_filenames: false
        verbose: true
        stages: [pre-commit]
        # ä¸é˜»å¡æäº¤ï¼Œåªç”ŸæˆæŠ¥å‘Š

      # ğŸ“Š æäº¤åæ˜¾ç¤ºæŠ¥å‘Šæ‘˜è¦
      - id: aiculture-summary
        name: "ğŸ“Š é—®é¢˜æ‘˜è¦æ˜¾ç¤º"
        entry: python
        args:
          [
            -c,
            "import json; import sys; from pathlib import Path; report_file = Path('artifacts/pre-commit-problems.json'); data = json.load(open(report_file)) if report_file.exists() else {}; summary = data.get('summary', {}); total, blocking = summary.get('total', 0), summary.get('blocking', 0); print('\\nğŸ” AICultureKit é—®é¢˜æ‘˜è¦:'); print(f'   æ€»è®¡: {total} ä¸ªé—®é¢˜'); print(f'   é˜»å¡æ€§: {blocking} ä¸ª'); print('âš ï¸  æ³¨æ„: å‘ç°é˜»å¡æ€§é—®é¢˜ï¼Œæ¨é€æ—¶å¯èƒ½è¢«æ‹¦æˆª\\nğŸ“‹ è¯¦ç»†æŠ¥å‘Š: artifacts/pre-commit-report.md') if blocking > 0 else print('ğŸ’¡ å‘ç°éé˜»å¡é—®é¢˜ï¼Œå»ºè®®ä¿®å¤ä»¥æå‡ä»£ç è´¨é‡') if total > 0 else print('âœ… æœªå‘ç°é—®é¢˜ï¼Œä»£ç è´¨é‡è‰¯å¥½'); print('')",
          ]
        language: system
        always_run: true
        pass_filenames: false
        stages: [pre-commit]

  # Python å®‰å…¨æ£€æŸ¥ (æš‚æ—¶ç¦ç”¨ï¼Œé…ç½®é—®é¢˜)
  # - repo: https://github.com/PyCQA/bandit
  #   rev: 1.7.5
  #   hooks:
  #     - id: bandit
  #       args: [-r, aiculture, -s, B101,B601]
  #       exclude: ^(tests/|aiculture-env/|\.venv/|venv/)

  # é€šç”¨æ–‡ä»¶æ£€æŸ¥
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-json
      - id: check-toml
      - id: check-merge-conflict
      - id: check-added-large-files
        args: [--maxkb=1000]
      - id: detect-private-key

  # å¯†é’¥æ³„æ¼æ£€æµ‹ (æš‚æ—¶ç¦ç”¨ï¼Œç‰ˆæœ¬å…¼å®¹é—®é¢˜)
  # - repo: https://github.com/Yelp/detect-secrets
  #   rev: v1.4.0
  #   hooks:
  #     - id: detect-secrets
  #       args: [--baseline, .secrets.baseline]
  #       exclude: package.lock.json

# æœ¬åœ°é’©å­é…ç½®
default_language_version:
  python: python3

# æœ€å° pre-commit ç‰ˆæœ¬
minimum_pre_commit_version: 3.0.0

# æ€§èƒ½ä¼˜åŒ–çš„å…¨å±€é…ç½®
default_stages: [pre-commit] # åªåœ¨commitæ—¶è¿è¡Œï¼Œä¸åœ¨pushæ—¶è¿è¡Œ
fail_fast: false # ä¸è¦åœ¨ç¬¬ä¸€ä¸ªé”™è¯¯æ—¶åœæ­¢
